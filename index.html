<!DOCTYPE HTML>
<html>
	<head>
		<title>Pixel Warlock</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="CSS/styles.css">
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<meta charset="utf-8">
		<script type="text/javascript">


			var editor = { // the primary editor object 


				screenDetails: {
					width: 0,
					height: 0
				},

				//views
				mainCanvas:  null,
				mainGraphicalContext: null,

				//main cursor

				cursor: null,

				// touch functionality

				touches: [],

				// default framerate 

				framerate: 1000 / 30

				//functions go here!

				updateScreen: function() {

					this.mainCanvas.width = this.screenDetails.width;
					this.mainCanvas.height = this.screenDetails.height; 


				}

				
			}

			var cursor = {
				// position

				x: 12,
 				y: 12,


				drawCursor: function (){

					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.moveTo(this.x - 3, this.y);
					editor.mainGraphicalContext.lineTo(this.x + 3, this.y);
					editor.mainGraphicalContext.stroke();

					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.moveTo(this.x, this.y - 3);
					editor.mainGraphicalContext.lineTo(this.x, this.y + 3);
					editor.mainGraphicalContext.stroke();

				},

				updateCursor: function(point) {

					this.x = point.x;
					this.y = point.y;

				}



			}


			function pageLoaded() {
				// init canvases

				editor.mainCanvas = document.getElementById('mainDraw');


				checkInitialization(editor.mainCanvas);


				// init contexts

				editor.mainGraphicalContext = editor.mainCanvas.getContext('2d');


				checkInitialization(editor.mainGraphicalContext);

				editor.cursor = cursor; 

				editor.cursor.drawCursor(); 


				editor.mainCanvas.addEventListener('touchend', function() {
					editor.mainGraphicalContext.clearRect(0, 0, editor.mainCanvas.width, editor.mainCanvas.height);
					editor.touches = [];
				});

				editor.mainCanvas.addEventListener('touchmove', function(event) {
  					event.preventDefault();
 					editor.touches = event.touches;


				});

				editor.mainCanvas.addEventListener('touchstart', function(event) {
  					console.log('start');

  					

				});

				editor.screenDetails.width = window.screen.width;
				editor.screenDetails.height = window.screen.height;

				editor.updateScreen();

				setInterval(update, editor.framerate );

			}

			function update() {

				editor.mainGraphicalContext.clearRect(0, 0, editor.mainCanvas.width, editor.mainCanvas.height);

				var i, len = editor.touches.length;


				for (i=0; i<len; i++) {
					var touch = editor.touches[i];

					console.log(touch);

					var sanitizedTouch = sanitizeTouchInput(touch);


   					var px = sanitizedTouch.clientX;
    				var py = sanitizedTouch.clientY;

    				console.log(sanitizedTouch);


					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.arc(px, py, 20, 0, 2*Math.PI, true);
					editor.mainGraphicalContext.fillStyle = "blue";
					editor.mainGraphicalContext.fill();
					editor.mainGraphicalContext.lineWidth = 2.0;
					editor.mainGraphicalContext.strokeStyle = "red";
					editor.mainGraphicalContext.stroke();

				}

				editor.mainGraphicalContext.strokeStyle = "black";
				editor.mainGraphicalContext.strokeText("TOUCH " + editor.touches.length , 20, 20);

			}

			function drawGrid() { 

				/*

					This function should be extended to accept paramters. For now, let's just draw a 10 * 10 grid. 

				*/



			}

			function checkInitialization(object) {
				if(object) {
					console.log(object + " has been initialized!");
				}
			}

			function mouseMovedOnCanvas() {
				// update cursor
			}

			function sanitizeTouchInput(evt) {
			var rect = editor.mainCanvas.getBoundingClientRect();

			console.log(rect);
			var touch = evt;

			var px = touch.clientX - rect.left;
			var py = touch.clientY - rect.top;


			return touch;

		}



		</script>
		
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body onload="pageLoaded()">
					<canvas id="mainDraw"></canvas>
	</body>
</html>