<!DOCTYPE HTML>
<html>
	<head>
		<title>Pixel Warlock</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="CSS/styles.css">
		<meta name="viewport" content="width=device-width, user-scalable=no">
		<meta charset="utf-8">
		<script type="text/javascript">


			var editor = { // the primary editor object 

				//views
				mainCanvas:  null,
				mainGraphicalContext: null,

				resultCanvas: null,
				resultGraphicalContext: null,

				//main cursor

				cursor: null,

				// touch functionality

				touches: [],

				// default framerate 

				framerate: 1000 / 30

				//functions go here!

				
			}

			var cursor = {
				// position

				x: 12,
 				y: 12,


				drawCursor: function (){

					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.moveTo(this.x - 3, this.y);
					editor.mainGraphicalContext.lineTo(this.x + 3, this.y);
					editor.mainGraphicalContext.stroke();

					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.moveTo(this.x, this.y - 3);
					editor.mainGraphicalContext.lineTo(this.x, this.y + 3);
					editor.mainGraphicalContext.stroke();

				},

				updateCursor: function(point) {

					this.x = point.x;
					this.y = point.y;

				}



			}


			function pageLoaded() {
				// init canvases

				editor.mainCanvas = document.getElementById('mainDraw');

				editor.resultCanvas = document.getElementById('resultView');

				checkInitialization(editor.mainCanvas);
				checkInitialization(editor.resultCanvas);

				// init contexts

				editor.mainGraphicalContext = editor.mainCanvas.getContext('2d');

				editor.resultGraphicalContext = editor.resultCanvas.getContext('2d');

				checkInitialization(editor.mainGraphicalContext);
				checkInitialization(editor.resultGraphicalContext);

				editor.cursor = cursor; 

				editor.cursor.drawCursor(); 


				editor.mainCanvas.addEventListener('touchend', function() {
					editor.mainGraphicalContext.clearRect(0, 0, editor.mainCanvas.width, editor.mainCanvas.height);
					editor.touches = [];
				});

				editor.mainCanvas.addEventListener('touchmove', function(event) {
  					event.preventDefault();
 					editor.touches = event.touches;


				});

				editor.mainCanvas.addEventListener('touchstart', function(event) {
  					console.log('start');

  					

				});



				setInterval(update, editor.framerate );

			}

			function update() {

				editor.mainGraphicalContext.clearRect(0, 0, editor.mainCanvas.width, editor.mainCanvas.height);

				var i, len = editor.touches.length;

				

				var string = 0;

				

				for (i=0; i<len; i++) {
					var touch = editor.touches[i];

					console.log(touch);

					var sanitizedTouch = sanitizeTouchInput(touch);


   					var px = sanitizedTouch.pageX;
    				var py = sanitizedTouch.pageY;

					editor.mainGraphicalContext.beginPath();
					editor.mainGraphicalContext.arc(px, py, 120, 0, 2*Math.PI, true);
					editor.mainGraphicalContext.fillStyle = "black";
					editor.mainGraphicalContext.fill();
					editor.mainGraphicalContext.lineWidth = 2.0;
					editor.mainGraphicalContext.strokeStyle = "red";
					editor.mainGraphicalContext.stroke();

					console.log('drawn circle at ' + px +',' + py);
					string++;
				}

				editor.mainGraphicalContext.strokeStyle = "black";
				editor.mainGraphicalContext.strokeText("TOUCH " + editor.touches.length + " loops: " + string, 20, 20);

			}

			function drawGrid() { 

				/*

					This function should be extended to accept paramters. For now, let's just draw a 10 * 10 grid. 

				*/



			}

			function checkInitialization(object) {
				if(object) {
					console.log(object + " has been initialized!");
				}
			}

			function mouseMovedOnCanvas() {
				// update cursor
			}

			function sanitizeTouchInput(evt) {
			var rect = editor.mainCanvas.getBoundingClientRect();
			var touch = evt;

			touch.pageX = touch.pageX - rect.left;
			touch.pageY = touch.pageY - rect.top;


			return touch;

		}



		</script>
		
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body onload="pageLoaded()">
		<div class="jumbotron">
  			<h1 style="text-align: center;">Pixel Warlock</h1> 
  			<p style="text-align: center;">Pixel Warlock is a simple pixel art editor for web. Current build is pre-alpha-stoneage-zero v.0.0.0.14. </p> 
		</div>

		<section class="container">
			<div class="row">
				<div class="col-sm-8">
					<canvas id="mainDraw" width = "640" height="480" style="border:black 1px solid;"></canvas>
				</div>
				<div  class="col-sm-4">
					<p>Buttons go here!</p>
					<canvas id="resultView" width = "480" height="320" style="border:black 1px solid;"></canvas>
				</div>
			</div>

		</section>
	</body>
</html>